<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Visualização STL no GitHub Pages</title>
    <style>
        /* Estilização para o visualizador ocupar toda a tela */
        body { margin: 0; overflow: hidden; }
        #viewer-container {
            width: 100vw;
            height: 100vh;
        }
    </style>
</head>
<body>

    <div id="viewer-container"></div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/loaders/STLLoader.js"></script>
    
    <script>
        const container = document.getElementById('viewer-container');
        const width = container.clientWidth;
        const height = container.clientHeight;

        // 1. Configurar a Cena
        const scene = new THREE.Scene();
        scene.background = new THREE.Color(0xeeeeee); // Cor de fundo cinza claro
        
        // 2. Configurar a Câmera
        const camera = new THREE.PerspectiveCamera(75, width / height, 0.1, 1000);
        camera.position.set(50, 50, 100); // Posição inicial da câmera

        // 3. Configurar a Luz (para o modelo ser visível)
        scene.add(new THREE.AmbientLight(0x404040, 5)); // Luz ambiente suave
        const directionalLight = new THREE.DirectionalLight(0xffffff, 1);
        directionalLight.position.set(0, 1, 1).normalize();
        scene.add(directionalLight);

        // 4. Configurar o Renderizador
        const renderer = new THREE.WebGLRenderer({ antialias: true });
        renderer.setSize(width, height);
        container.appendChild(renderer.domElement);

        // 5. Carregar o Arquivo STL
        const loader = new THREE.STLLoader();
        
        // **IMPORTANTE:** Mude este URL para o caminho do seu arquivo STL no GitHub Pages
        const stlFilePath = 'qrcode.stl'; 
        
        loader.load(stlFilePath, function (geometry) {
            // Material do modelo
            const material = new THREE.MeshPhongMaterial({ 
                color: 0x5a9aed, // Cor do objeto (azul)
                specular: 0x111111,
                shininess: 200 
            });
            
            // Criar a malha
            const mesh = new THREE.Mesh(geometry, material);

            // Centralizar e posicionar o modelo
            geometry.computeBoundingBox();
            const center = new THREE.Vector3();
            geometry.boundingBox.getCenter(center);
            mesh.position.sub(center); // Centraliza a geometria na origem

            scene.add(mesh);
            
            // Focar a câmera no modelo após o carregamento (opcional, mas bom para enquadrar)
            const box = new THREE.Box3().setFromObject(mesh);
            const size = box.getSize(new THREE.Vector3());
            const maxDim = Math.max(size.x, size.y, size.z);
            const fov = camera.fov * (Math.PI / 180);
            let cameraDistance = Math.abs(maxDim / 2 / Math.tan(fov / 2));
            cameraDistance *= 1.5; // Um pequeno offset para não ficar muito perto
            camera.position.z = cameraDistance;
            
            // Adicionar Controles de Órbita (para interatividade)
            const controls = new THREE.OrbitControls(camera, renderer.domElement);
            controls.enableDamping = true; // para um movimento mais suave
            controls.dampingFactor = 0.05;
            controls.screenSpacePanning = false;
            controls.minDistance = 1;
            controls.maxDistance = 500;
            controls.target.copy(mesh.position); // Foca os controles no centro do modelo

            // 6. Loop de Animação e Renderização
            function animate() {
                requestAnimationFrame(animate);
                controls.update(); // Necessário se enableDamping estiver ativado
                renderer.render(scene, camera);
            }
            animate();
            
            // Tratamento de redimensionamento da janela
            window.addEventListener('resize', onWindowResize, false);
            function onWindowResize(){
                camera.aspect = window.innerWidth / window.innerHeight;
                camera.updateProjectionMatrix();
                renderer.setSize(window.innerWidth, window.innerHeight);
            }

        }, (xhr) => {
            // Progresso do carregamento (opcional)
            console.log( ( xhr.loaded / xhr.total * 100 ) + '% loaded' );
        }, (error) => {
            // Erro de carregamento
            console.error( 'An error happened during STL loading', error );
            container.innerHTML = 'Falha ao carregar o modelo STL.';
        });
        
        // Incluir OrbitControls (para mover o objeto)
        // Coloque isso após Three.js e antes do seu script principal
        // NOTE: Adicionar THREE.OrbitControls como script separado
        const orbitControlsScript = document.createElement('script');
        orbitControlsScript.src = 'https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/controls/OrbitControls.js';
        document.head.appendChild(orbitControlsScript);

    </script>
</body>
</html>
